package springmvc.demo.controller.user;

import java.util.List;

import javax.servlet.http.Cookie;

import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.CookieValue;
import org.springframework.web.bind.annotation.RequestAttribute;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestParam;
import org.springframework.web.servlet.ModelAndView;

import springmvc.demo.dto.ProductDto;
import springmvc.demo.entity.Product;

@Controller
public class HomeController extends BaseController {

	@RequestMapping({"/home","/trang-chu"})
	public ModelAndView index(@CookieValue Object arr[]) {
//		modelAndView.addObject("listProduct", homeServer.dsProductTop9());
		try {
			  arr[] = req.getCookies();
		       
				
				
		        PrintWriter out = resp.getWriter();
		        List<Product> listCc = new ArrayList<>();
		        ProductFacade dao = new ProductImpl();
		        for (Cookie o : arr) {
		            if (o.getName().equals("productID")) {
		                String txt[] = o.getValue().split("/");
		                for (String s : txt) {
		                	listCc.add(dao.getProduct(s));
		                }
		            }
		        }
		        int soLuong=0;
		        for (int i = 0; i < listCc.size(); i++) {
		            int count = 1;
		            for (int j = i+1; j < listCc.size(); j++) {
		                if(listCc.get(i).getProductID() == listCc.get(j).getProductID()){
		                    count++;
		                    listCc.remove(j);
		                    j--;
		                    listCc.get(i).setAmount(count);
		                }
		            }
		            soLuong++;
		        }
		      ///
		        req.setAttribute("soLuong", soLuong);
						  
		} catch (Exception e) {
			// TODO: handle exception
			
		}
		
		modelAndView.setViewName("customer/index");
		return modelAndView;
	}
}
