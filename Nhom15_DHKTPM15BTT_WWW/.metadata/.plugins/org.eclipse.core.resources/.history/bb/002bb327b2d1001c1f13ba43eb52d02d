package springmvc.demo.controller.admin;

import java.io.IOException;

import javax.servlet.http.Cookie;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import javax.servlet.http.HttpSession;

import org.hibernate.Session;
import org.springframework.stereotype.Controller;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.servlet.ModelAndView;

import springmvc.demo.entity.Role;
import springmvc.demo.entity.Users;

@Controller
public class ADLoginController {

	@RequestMapping("/adlogin")
	public String showformlogin(HttpServletResponse response, HttpServletRequest request) throws IOException {
		return "customer/login";
	}

	@PostMapping("/login")
	public String login(HttpServletResponse response, HttpServletRequest request) {
		String ten = request.getParameter("name");
		String pass = (String) request.getParameter("pass");
		HttpSession session = request.getSession();

		// tim sdt de lay id_user
		session.setAttribute("phone", homeServer.timKiemUserByPhone(ten));
//		Users users=productFacade.timKiemUserLogin(ten, pass);
		if (homeServer.timKiemUserLogin(ten, pass) == null) {
			return "customer/login";
		} else {
			Cookie arr[] = request.getCookies();
			for (Cookie o : arr) {
				if (o.getName().equals("productID")) {
					o.setMaxAge(0);
					response.addCookie(o);
				}
			}
			session.setAttribute("acc", homeServer.timKiemUserLogin(ten, pass));
			return "redirect:home";
		}
		return "customer/login";
	}

	@GetMapping("/logout")
	public String logout(HttpServletResponse response, HttpServletRequest request) {
		HttpSession session = request.getSession();
		session.removeAttribute("acc");
		return "redirect:home";
	}

	

	
}
